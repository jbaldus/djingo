{# templates/bingo/home.html #}
{% extends "bingo/base.html" %}

{% block content %}
<div class="container">
    {% if user.is_authenticated %}
    <div class="admin-section">
        <a href="/admin"><button class="button button-admin">Admin</button></a>
    </div>
    {% endif %}
    <div class="join-game-section">
        <h2>Join a Game</h2>
        <div class="active-games-section">
            <h2>Active Games</h2>
            {% if games %}
                <div class="game-list">
                    {% for game in games %}
                        {% if game.is_active and not game.is_private %}
                            <div class="game-card">
                                <h3>Game Title: {{ game.name }}</h3>
                                <p>Game Code: {{ game.code }}</p>
                                <p>Board: {{ game.board.name }}</p>
                                <p>Status: {% if game.is_active %}Active{% else %}Ended{% endif %}</p>
                                <p>Players: {{ game.players.count }}</p>
                                {% if game.is_active %}
                                    <a href="/play/{{ game.code }}"><button class="button button-primary">Play Game</button></a>
                                    {% if user.is_authenticated %}
                                        <button class="button" onclick="endGame({{ game.id }})">End Game</button>
                                    {% endif %}
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <p>There are no active games at the moment. Check back later.</p>
            {% endif %}
        </div>
        <div class="game-code-join-section">
            <details>
                <summary><h2>Have a code?</h2></summary>
                <form class="join-form" method="GET" onsubmit="return handleJoinGame(event)">
                    <div class="form-group">
                        <input type="text" 
                            id="gameCode"
                            name="code" 
                            class="form-control" 
                            placeholder="Enter game code"
                            pattern="[A-Za-z0-9]{3}"
                            required>
                    </div>
                    <button type="submit" class="button button-primary">Join Game</button>
                </form>
            </details>
        </div>
    </div>

    {% if user.is_authenticated %}
        <div class="my-boards-section">
            <h2>My Boards</h2>
            {% if boards %}
                <div class="board-list">
                    {% for board in boards %}
                        <div class="board-card">
                            <h3>{{ board.name }}</h3>
                            <p>Created: {{ board.created_at|date }}</p>
                            <div class="board-actions">
                                <button class="button" onclick="editBoard({{ board.id }})">Edit</button>
                                <button class="button" onclick="createGame({{ board.id }})">Create Game</button>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>You haven't created any boards yet.</p>
            {% endif %}
            <button class="button button-primary" onclick="createBoard()">Create New Board</button>
        </div>
    {% endif %}
</div>

<script>
function handleJoinGame(event) {
    event.preventDefault();
    const code = document.getElementById('gameCode').value.toUpperCase();
    window.location.href = `/play/${code}/`;
    return false;
}

function editBoard(boardId) {
    // We'll implement this later with the API
    console.log('Edit board:', boardId);
}

function createGame(boardId) {
    // We'll implement this later with the API
    console.log('Create game from board:', boardId);
}

function createBoard() {
    // We'll implement this later with the API
    console.log('Create new board');
}

function endGame(gameId) {
    // We'll implement this later with the API
    console.log('End game:', gameId);
}
</script>
{% endblock %}