{# templates/bingo/play_game.html #}
{% extends 'bingo/base.html' %}

{% block content %}
<div hx-ext="ws" ws-connect="/ws/game/{{ player.id }}/">
<div class="container">
    <div class="game-header">
        <h1>Bingo Game</h1>
        <div class="player-info">
            Playing as: <strong>{{ player.name }}</strong>
        </div>
    </div>

    <div class="bingo-board board-{{ game.board_size }}x{{ game.board_size }}" 
        id="bingoBoard" 
        data-player-id="{{ player.id }}"
        data-board-size="{{ game.board_size }}"
        data-win-condition="{{ game.win_condition }}">
    {% for item in board_items %}
        <div class="bingo-cell {% if forloop.counter0 in player.covered_positions %}covered{% endif %}" 
                id="cell-{{ forloop.counter0 }}"
                data-position="{{ forloop.counter0 }}"
                {% if forloop.counter0 in player.covered_positions %}
                data-covered="true"
                {% endif %}
                {% if game.has_free_square and game.board_size == 5 and forloop.counter0 == 12 %}
                data-free="true"
                {% else %}
                hx-trigger="click"
                hx-swap="outerHTML"
                hx-target="this"
                hx-vals='{"type": "mark_position", "position": "{{ forloop.counter0 }}"}'
                hx-ws="send"
                {% endif %}>
            {{ item }}
        </div>
    {% endfor %}
    </div>

    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <h2>We Have a Winner!</h2>
            <p id="winnerMessage"></p>
            <div class="modal-buttons">
                <button class="button button-primary" onclick="clearBoard()">Play Again</button>
                <button class="button button-secondary" onclick="window.location='/'">Home</button>
            </div>
        </div>
    </div>
</div>
<div id="errorMessage" class="error-message" style="display: none;"></div>
<div id="connectedPlayers" class="connected-players"></div>
<!--EVENT-UI-HTML-->
<div class="game-events">
    <div id="eventsList" class="events-list"></div>
</div>
</div>
{% endblock %}
